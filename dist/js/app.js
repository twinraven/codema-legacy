/**
 *   - v0.1.0 - 2014-10-13
 *  (c) 2014 Tom Bran All Rights Reserved
 */ 

var App=angular.module("Codema",["ngRoute"]);App.service("companiesService",["$location",function(a){var b=[],c=[{name:"Company 1",id:1,address:"1 St. John's Lane, London, EC1M 4BL",notes:"Some notes here\n\nsome more notes",contactName:"Dave Smith",contactEmail:"dave@example.com",contracts:[{startDate:"2012-12-12",endDate:"2013-02-01",renewals:2,rate:10,$$hashKey:"01J"},{startDate:"2013-06-10",endDate:"2013-08-12",renewals:0,rate:10,$$hashKey:"01K"}]},{name:"Company 2",id:2,address:"1 St. John's Lane, London, EC1M 4BL",notes:"Some notes here\n\nsome more notes",contactName:"Rob Ford",contactEmail:"rob@example.com",contracts:[]}],d={};return d.loadCompanyData=function(){var a=window.localStorage.getItem("companiesList");Modernizr.localstorage&&a&&(b=JSON.parse(window.localStorage.getItem("companiesList"))),0===b.length&&(b=c)},d.saveCompanyData=function(){navigator.onLine,window.localStorage.setItem("companiesList",JSON.stringify(b))},d.addCompany=function(a){a.id=b&&b.length?b[b.length-1].id+1:1,b.push(a),d.saveCompanyData()},d.getCompanies=function(){return b},d.getCompany=function(a){return a=parseInt(a,10),_.find(b,function(b){return _.isEqual(b.id,a)})},d.removeCompany=function(c){c&&(b=_.without(b,c),a.path("/home")),d.saveCompanyData()},d.removeContract=function(a,b){d.getCompany(a).contracts.splice(b,1)},d.loadCompanyData(),d}]),App.controller("AddController",["$scope","companiesService",function(a,b){a.company={},a.company.contracts=[],a.saveCompany=function(){b.addCompany(a.company)},a.addContract=function(){a.company.contracts.push({})},a.removeContract=function(b){confirm("Are you sure?")&&a.company.contracts.splice(b,1)}}]),App.controller("appController",["$rootScope","$scope",function(){}]),App.controller("CompanyController",["$scope","$routeParams","companiesService",function(a,b,c){a.company=c.getCompany(b.companyId),a.editing=b.editing,a.addContract=function(){a.company.contracts.push({})},a.removeContract=function(b){confirm("Are you sure?")&&c.removeContract(a.company.id,b)},a.deleteCompany=function(){confirm("Are you sure?")&&c.removeCompany(a.company)},a.$watch("$scope.company",c.saveCompanyData,!0)}]),App.controller("ContactController",["$scope","companiesService",function(a,b){a.companies=b.getCompanies(),a.companiesWithContact=_.filter(a.companies,function(a){return a.contactName}),a.companiesNotDisplayed=a.companies.length-a.companiesWithContact.length,a.hasContactsWithoutContact=!!a.companiesNotDisplayed,1===a.companiesNotDisplayed?(a.companiesSuffix="y",a.companiesDescriptor="is"):(a.companiesSuffix="ies",a.companiesDescriptor="are"),a.contacts=_.uniq(_.pluck(a.companiesWithContact,"contactName")),a.companiesByContact=_.groupBy(a.companiesWithContact,function(a){return a.contactName})}]),App.controller("HomeController",["$scope","companiesService",function(a,b){a.companies=b.getCompanies()}]),App.directive("blur",[function(){return function(a,b,c){b.bind("blur",function(){a.$apply(c.blur)})}}]),App.config(["$routeProvider",function(a){a.when("/home",{templateUrl:"partials/home.html",controller:"HomeController"}),a.when("/add",{templateUrl:"partials/add.html",controller:"AddController"}),a.when("/company/:companyId",{templateUrl:"partials/company.html",controller:"CompanyController"}),a.when("/contacts",{templateUrl:"partials/contact.html",controller:"ContactController"}),a.otherwise({redirectTo:"/home"})}]);